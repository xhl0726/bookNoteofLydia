[TOC]

# 计算机网络

## 基础篇--一开始话真多的十二题

### 一、请简述 TCP/UDP 的区别

运输层，主要任务是向用户提供可靠的端到端的差错和流量控制，保证报文的正确运输。

主要使用两种协议：

* 传输控制协议 TCP——提供面向连接的，可靠的数据传输服务，数据传输单位是**报文段**。可以进行丢包的重发控制，顺序的纠正。作为一种面向有连接的协议，只有在确认通信对端存在时才会发送数据，从而进行流量控制。
* 用户数据报协议 UDP，数据传输单位是**用户数据报**。常常被用于让广播和细节控制交给应用的通信传输。网络拥堵时不提供流量控制，传输过程丢包不负责重发。包的顺序乱掉不负责纠正，收到包即刻原样转发出去。主要用于对高速传输和实时性要求较高的通信或广播通信。如 IP 电话。

区分：

* TCP 面向连接，UDP无连接。
* TCP提供可靠的服务，具有顺序控制，重发控制等机制，可以为应用提供可靠运输。UDP尽最大努力的数据传输服务（不保证可靠交付）。但是UDP没有拥塞控制，因此网络出现拥塞不会使源主机的发送速率降低，对实时应用很有用，如 IP 电话。
* TCP数据传输速度慢，UDP 数据传输快。
* TCP 面向字节流（TCP将数据看作一连串无结构的字节流），UDP面向报文。
* TCP 连接只能是点到点，UDP 支持一对一，一对多，多对一，多对多。
* TCP 首部开销 20 字节，UDP首部开销只有 8 字节。
* TCP 的逻辑通信信道是全双工的可靠信道，UDP 则是不可靠信道。

### 二、请简单说一下你了解的端口及对应的服务

物理意义上端口，如交换机、路由器用于连接其他网络设备的接口等。

逻辑意义上的端口，一般指TCP/IP 协议中的端口，端口号范围0到65535，用于浏览网页服务的80端口，用于FTP服务的21端口等。

按端口号分布划分有知名端口（0-1023，一般固定分配给一些服务），如25端口分配给SMTP （简单邮件传输协议）服务，**80 端口分配给 HTTP 服务**等。动态端口，1024-65535，一般不固定分配，运行的程序向系统提出访问网络的申请，系统分配一个端口号。**MySQL数据库服务 3306端口**。

按协议类型划分有TCP、UDP、IP、ICMP等端口。TCP端口即传输控制协议端口，需要在客户端和服务器间建立连接，包括FTP 服务的21 端口，**Telnet （远程登录）服务的23 端口**，SMTP 服务的 25 端口，以及 HTTP 服务的80 端口等。UDP 端口即用户数据报协议端口，无需建立连接，常见有**DNS （域名服务器）服务的53端口**，SNMP服务的161端口，QQ 使用的8000和4000端口等。

### 三、TCP 的三次握手四次挥手

三次握手即建立 TCP 连接时，需要客户端和服务器总共发送三个包以确认连接的建立。在 socket 编程中，这一过程由客户端执行 connect 来触发。（three-way handshake，三报文握手，不是握手三次，但是普遍理解且称呼的都是三次握手，所以知道就好）在这过程中，双方通过**维护一个序列号**，建立可靠连接。

A 为客户端，B 为服务器端。

* B 处于 LISTEN(监听)状态，等待客户的连接请求。
* A 向 B 发送连接请求报文，SYN=1，ACK =0，选择一个初始的序号 x 。
* B 收到连接请求报文，如果同意建立连接，则向 A 发送连接确认报文，SYN=1，ACK=1，确认号为 x+1，同时也选择了一个初始的序号y。
* A 收到 B 的连接确认报文后，还要向 B 发出确认，确认号为 y+1，序号为 x+1 。
* B 收到 A 的确认后，连接建立。

客户端发送的请求如果在网络中滞留，那么隔很久才会收到服务器发回的连接确认。由于三次握手的存在，客户端会忽略服务器的二次请求，不重复打开连接。

服务器发送第二次握手的请求长期没有回应，会**释放相关资源**。此时在另一端，客户端迟迟收不到回应，会再次发送连接请求。

四次挥手：

* A 发送连接释放报文，FIN =1。
* B 收到后发出确认，此时 TCP 属于半关闭状态，B 能向 A 发送数据但 A 不能向 B 发送数据。
* 当 B 不再需要连接时，发送连接释放报文，FIN =1。
* A 收到后发出确认，进入 TIME_WAIT 状态，等待 2 MSL（最大报文存活时间）后释放连接。
* B 收到 A 的确认后释放连接。

**四次挥手的原因**：

客户端发送了 FIN 连接释放报文后，服务器收到这个报文，进入 CLOSE-WAIT 状态。这个状态是为了让服务器发送还未传送完毕的数据，**传送完毕后**，服务器会发送 FIN 连接释放报文。

**TIME_WAIT**

三次挥手时，客户端没有直接释放连接，而是等待 2MSL，原因有二：

* 确保最后一个确认报文能够到达，如果 B 没收到 A 发送来的确认报文，会重新发送连接释放请求报文，A 等待一段时间就是为了处理这种情况。
* 等待一段时间是为了让本连接持续时间内所产生的报文都从网络中消失，使得下一个新的连接不会出现旧的连接请求报文。

### 四、有哪些私有（保留）地址

* A类：`10.0.0.0 - 10.255.255.255`是私有地址，`127.0.0.0-127.255.255.255`是保留地址，用作循环测试使用。

* B类：`172.16.0.0 - 172.31.255.255`是私有地址，`169.254.0.0-169.254.255.255`是保留地址，如果你的 IP 地址是自动获取 IP 地址，而在网络上又没有找到可用的 DHCP 服务器，这是将在`169.254.0.1-169.254.255.254`中临时获得一个 IP 地址。

* C类：`192.168.0.0 - 192.168.255.255`是私有地址。

私有 IP 地址是一段保留的 IP 地址，只使用在局域网中，无法在公网使用。

### 五、 IP 地址分为哪几类？简单说下各个分类

IPv4 地址共 32 bit，分为 A，B，C，D，E 类。

* A 类，网络号以 0 开头，地址范围 `1.0.0.0-127.255.255.255`，网络号 8 位，主机号 24 位。子网掩码`255.0.0.0`
* B 类，网络号以 10 开头，地址范围 `128.0.0.0-255.255.255`，网络号 16 位，主机号 16 位。子网掩码`255.255.0.0`
* C 类，网络号以 110 开头，地址范围 `192.0.0.0-223.255.255.255`，网络号 24 位，主机号 8 位。子网掩码`255.255.255.0`
* D 类，前四位固定为 1110，后面为多播地址，所以 D 类地址为多播地址。
* E 类，前五位固定为 11110，后面保留为今后使用。

IPv6 地址共128 bit，首部固定部分为 40 字节。

子网掩码是一个 32 位地址，与 IP 地址结合使用的一种技术，两个作用：

1. 屏蔽 IP 地址的一部分用于区别网络标识和主机标识，并说明该 IP 地址是在局域网上，还是在远程网上。
2. 用于将一个大的 IP 网络划分为若干个小的子网。

子网掩码的位数决定于可能的子网数目和每个子网的主机数目。

### 六、 在浏览器中输入网址后执行会发生什么

* 查找域名对应的 IP 地址。依次查找浏览器缓存，系统缓存，路由器缓存， ISPNDS 缓存，根域名服务器。
* 浏览器向 IP 对应的 web 服务器发送一个 HTTP 请求。
* 服务器响应请求，发回网页内容。
* 浏览器解析网页内容。

### 七、简单解释一下 ARP 协议的工作过程

ARP，地址解析协议，根据 IP 地址获取物理地址的一个TCP/IP协议。处理**同一个局域网**上，主机和和路由器的 IP 地址与MAC 地址的映射关系。

* 每个主机上都设有一个 **ARP高速缓存**，保存本局域网中各主机和和路由器的 IP 地址与MAC 地址的映射关系。

* 主机 A 向本局域网的主机 B 发送 IP 数据报时，首先检查自己的 ARP 列表中是否有 B 的 MAC 地址，如果有，则直接发送数据；若否，则向本网段的所有主机发送 ARP 数据包，包括：A 的 IP 地址，A 的 MAC 地址，B 的 IP 地址。
* 本网络的所有主机收到该 ARP 数据包时，首先检查自己的 IP 是不是目的IP，若不是则忽略该数据包；若是则将 A 的 IP 地址和 MAC 地址写入自己的 ARP 缓存中。
* 主机 B 将包含其 MAC 地址的 回复消息直接发送回主机 A。
* 主机 A 收到 ARP 响应包后，将 B 的 IP 地址和 MAC 地址写入自己的 ARP 列表，并发送数据。如果一直没收到相应包，表示 ARP 查询失败。

### 八、说一下 OSI 七层模型

OSI/RM，开放系统互联基本参考模型。一个试图让各种计算机在世界范围内互联成网的标准框架。因为制定周期过长使得应用设备无法及时到达时长、实现起来过于复杂且运行效率过低，层次划分不太合理，层级之间有些功能多次出现等原因，只获得了一些理论研究的成果，在市场化失败。市场化通常采用 TCP/IP 四层模型。

1. 物理层，使用传输介质为数据链路层提供物理连接，实现比特流的透明传输。

2. 数据链路层，负责建立和管理节点间的链路。主要功能是通过各种*控制协议*，将有差错的物理信道变为无差错的、能可靠传输数据帧的数据链路。将网络层交下来的**IP数据报**组装成**帧**。**解决同一网络内节点之间的通信。**这两层可以合称网络接口层。

3. 网络层，OSI 参考模型中**最复杂一层**，也是通信子网的最高一层。**解决不同子网间的通信**。主要任务是通过*路由选择算法*，为报文或分组通过通信子网选择最适当的路径。在发送数据时，网络层将运输层产生的报文段或用户数据报封装成**分组**或**包**进行传送，在 TCP/IP 体系中，分组也叫作 **IP 数据报**。

  * 该层控制数据链路层和运输层之间的信息转发，建立、维持和终止网络的连接。
  * 实际上，数据链路层的数据在这一层被转换为数据包，通过路径选择、分段组合、顺序、进/出路由等控制，将信息从一个网络设备传输到另一个网络设备。

      主要解决的问题如下：

    ​	  **1.** 寻址，数据链路层用的物理地址仅解决网络的内部寻址，在不同子网间通信时，每一个子网中的设备都会被分配唯一的地址。各子网使用的物理技术不同，因此该地址应当是逻辑地址（如 IP 地址）。

    ​	  **2.** 交换，规定不同的信息交换方式，常见的交换技术有线路交换技术和存储转发技术，后者包括报文交换技术和分组交换技术。

    ​	  **3.** 路由算法，源节点和目的节点之间存在多条路径时，本层通过路由算法为数据分组选择最佳路径。

    ​	  **4.** 连接服务：防止阻塞，并进行差错检测。

4. 运输层，OSI 下三层主要任务是**数据通信**，上三层主要任务是**数据处理**。因此本层负责向两台主机中的进程提供通用的数据传输服务，起到承上启下的作用。主要任务是向用户提供可靠的端到端的差错和流量控制，保证报文的正确运输。向高层屏蔽下层数据通讯的细节，向用户透明的传送报文。

   主要使用两种协议：

   * 传输控制协议 TCP——提供面向连接的，可靠的数据传输服务，数据传输单位是**报文段**。
   * 用户数据报协议 UDP——提供无连接的，尽最大努力的数据传输服务（不保证数据传输的可靠性），数据传输单位是**用户数据报**。

5. 会话层，表示层和应用层。应用层的任务是通过应用进程之间的交互来完成特定网络应用。应用层协议定义的是应用进程间通信和交互的规则。如 域名系统 DNS，支持万维网应用的 HTTP 协议，支持电子邮件的 SMTP 协议，等等。应用层交互的数据单元称为 报文。

实际学习计网原理时采取折中的办法，使用五层协议，物理层、数据链路层、网络层、运输层和应用层。

### 九、说一下 TCP/IP 四层模型

网络接口层（对应物理层+数据链路层），网络层 IP ，运输层（ TCP 或 UDP），应用层（各种应用层协议如 TELNET ,  FTP ,  SMTP 等） 。

* 网络接口层在 TCP/IP 参考模型中没有真正描述实现，提供给网络层一个传输接口，以便在上面传递 IP 分组。
* 网络层，解决不同子网之间的通信；通过路由选择算法为 IP 数据报选择最合适的路径；拥塞控制。
* 运输层，TCP协议或UDP 协议。
* 应用层，面向不同的网络应用有不同的协议。

### 十、 HTTP 协议包括哪些请求

* GET，对服务器资源的简单请求
* POST，用于发送包含用户提交数据的请求。
* HEAD，类似于 GET，返回的响应中无具体内容，用于获取报头
* PUT，请求文档的一个版本
* DELETE，发送一个删除指定文档的请求
* TRACE，发送一个请求副本，以跟踪其处理进程。
* OPTIONS，返回所有可用的方法，检查服务器支持哪些方法
* CONNECT，用于 ssl 隧道的基于代理的请求

### 十一、简述 HTTP 中 GET 和POST 的区别

原理上：

* GET 用于信息获取，应该是安全和幂等的。
* POST 可能修改服务器上资源的请求。

表面上：

* GET 请求的数据会附在 URL 后面，POST 的数据放在 HTTP 包内。
* POST 安全性比 GET 高。 

### 十二、简述TCP 流量控制和拥塞控制

#### 流量控制

流量控制是为了控制发送方发送速率，保证接收方来得及接受。

接收方发送的确认报文中的窗口字段可以用来控制发送方窗口大小，从而影响发送方的发送速率，将窗口字段设置为0，则发送方不能发送数据。

#### 拥塞控制

如果网络出现拥塞，分组将会丢失，此时发送方会继续重传，从而导致网络拥塞程度更高。因而当发生拥塞时，应当控制发送方的速率。和流量控制相似但出发点不同，流量控制是为了**让接收方能来得及接受**，拥塞控制是为了**降低整个网络的拥塞程度**。

发送方维护一个叫做拥塞窗口（cwnd）的状态变量。（实际决定发送发能发送多少数据的是发送方窗口）

TCP 通过四个算法进行拥塞控制，慢开始，拥塞避免，快重传，快恢复。两两搭配。

* 慢开始和拥塞避免：

  拥塞窗口 =1，发送方只能发送一个报文段，收到确认时，cwnd 加倍，因此之后能够发送的报文段数量为2,4,8...

  慢开始每个轮次都将 cwnd 加倍，发送方速度增长很快，网络拥塞可能性更高。设置慢开始门限ssthresh，当cwnd>ssthresh 时，进入拥塞避免，每个轮次只将 cwnd 增加 1 。

  如果出现了超时，则令 ssthresh = cwnd / 2，然后重新执行慢开始，即 cwnd = 1。

* 快重传与快恢复：

  在接收方，要求每次收到报文段都直接对最后一个已收到的有序报文段进行确认。

  在发送方，连续收到三个重复确认，则知道下一个报文段丢失，此时执行**快重传**，立即重传下一个报文段。

  在这种情况下，只是丢失个别报文段，而不是网络拥塞，因此执行**快恢复**，ssthresh = ssthresh / 2，cwnd = ssthresh，并开始执行拥塞避免（cwnd 一次加一）。





## 查漏补缺篇--各层攻坚

1. ipconfig 的作用

   显示当前 TCP/IP 配置的信息。

2. 